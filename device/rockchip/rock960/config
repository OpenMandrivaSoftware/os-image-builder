ARCH="aarch64"
# Let's support what people might drop into those PCI-E slots...
#HWPACKAGES="pciutils kernel-firmware kernel-firmware-extra iwlwifi-agn-ucode efibootmgr"
# kernel-firmware-extra is needed for the USB-C DisplayPort module (rockchip/dptx.bin)
HWPACKAGES="wpa_supplicant kernel-firmware-extra"
HWPACKAGES_gui="lib64dri-drivers-lima"
#KERNEL="https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git#v5.11-rc1"
#KERNEL_CONFIG="defconfig"
KERNEL="https://github.com/megous/linux.git#orange-pi-5.12"
# Not quite, but close enough...
KERNEL_CONFIG="pinebook_pro_defconfig"
UBOOT_CONFIG="rock960-rk3399_defconfig"
UBOOT_VERSION="v2021.01-rc4"
KERNELTARGET=Image
DTB="rockchip/rk3399-rock960"
# Make sure we have NVM-E -- we may also want to enable various USB devices
# PCI is required by NVM-E
KERNEL_EXTRACONFIG="--enable NVM --enable NVM_PBLK --disable NVM_PBLK_DEBUG --enable NVME_CORE --enable BLK_DEV_NVME --enable NVME_MULTIPATH --enable NVME_HWMON --enable PCI --module FUSE_FS --module FW_CFG_SYSFS --enable FW_CFG_SYSFS_CMDLINE --enable PCIEPORTBUS --module BPFILTER_UMH --enable PCIEAER --disable PCIEAER_INJECT --disable PCIE_ECRC --disable PCIEASPM_PERFORMANCE --enable PCIEASPM_DEFAULT --disable PCIEASPM_POWERSAVE --disable PCIEASPM_POWER_SUPERSAVE --disable PCIE_DPC --disable PCIE_PTM --enable PCIE_BW --disable PCI_DEBUG --disable PCI_STUB --disable PCI_IOV --disable PCI_PRI --disable PCI_PASID --disable HOTPLUG_PCI --disable PCI_FTPCI100 --enable PCI_HOST_GENERIC --disable PCIE_XILINX --disable PCI_XGENE --disable PCIE_ALTERA --disable PCI_HOST_THUNDER_PEM --disable PCI_HOST_THUNDER_ECAM --enable PCIE_ROCKCHIP_HOST --disable PCIE_DW_PLAT_HOST --disable PCI_HISI --disable PCIE_KIRIN --disable PCI_MESON --disable PCIE_AL --disable PCIE_LAYERSCAPE_GEN4 --disable PCIE_CADENCE_PLAT_HOST --disable PCI_J721E_HOST --disable PCI_ENDPOINT --disable PCI_SW_SWITCHTEC --disable RAPIDIO --disable BLK_DEV_PCIESSD_MTIP32XX --disable BLK_DEV_UMEM --disable BLK_DEV_SKD --disable BLK_DEV_SX8 --disable BLK_DEV_RSXX --module NVME_TCP --disable PHANTOM --disable TIFM_CORE --disable HP_ILO --disable PCI_ENDPOINT_TEST --disable CB710_CORE --disable GENWQE --disable MISC_ALCOR_PCI --disable MISC_RTSX_PCI --disable HABANA_AI --disable FUSION --disable FIREWIRE --disable FIREWIRE_NOSY --disable NET_FC --disable ARCNET --disable FDDI --disable HIPPI --disable BRCMFMAC_PCIE --disable VMXNET3 --disable SERIAL_8250_PCI --disable SERIAL_JSM --disable SERIAL_RP2 --disable NOZOMI --disable APPLICOM --disable DEVPORT --disable I2C_ALI1535 --disable I2C_ALI1563 --disable I2C_ALI15X3 --disable I2C_AMD756 --disable I2C_AMD8111 --disable I2C_I801 --disable I2C_ISCH --disable I2C_PIIX4 --disable I2C_NFORCE2 --disable I2C_NVIDIA_GPU --disable I2C_SIS5595 --disable I2C_SIS630 --disable I2C_SIS96X --disable I2C_VIA --disable I2C_VIAPRO --disable I2C_DESIGNWARE_PCI --disable I2C_THUNDERX --disable SPI_PXA2XX --disable SPI_THUNDERX --disable GPIO_BT8XX --disable GPIO_PCI_IDIO_16 --disable GPIO_PCIE_IDIO_24 --disable GPIO_RDC321X --disable SENSORS_I5K_AMB --disable SENSORS_SIS5595 --disable SENSORS_VIA686A --disable SENSORS_VT8231 --disable ALIM7101_WDT --disable I6300ESB_WDT --disable PCIPCWATCHDOG --disable WDTPCI --disable LPC_ICH --disable LPC_SCH --disable MFD_JANZ_CMODIO --disable MFD_RDC321X --disable MFD_VX855 --disable MEDIA_PCI_SUPPORT --disable VIDEO_CAFE_CCIC --set-val VGA_ARB_MAX_GPUS 16 --disable DRM_RADEON --disable DRM_AMDGPU --disable DRM_NOUVEAU --disable DRM_AST --disable DRM_MGAG200 --disable DRM_QXL --disable DRM_BOCHS --disable DRM_HISI_HIBMC --disable DRM_CIRRUS_QEMU --disable FB_CIRRUS --disable FB_PM2 --disable FB_CYBER2000 --disable FB_ASILIANT --disable FB_IMSTT --disable FB_NVIDIA --disable FB_RIVA --disable FB_I740 --disable FB_MATROX --disable FB_RADEON --disable FB_ATY128 --disable FB_ATY --disable FB_S3 --disable FB_SAVAGE --disable FB_SIS --disable FB_NEOMAGIC --disable FB_KYRO --disable FB_3DFX --disable FB_VOODOO1 --disable FB_VT8623 --disable FB_TRIDENT --disable FB_ARK --disable FB_PM3 --disable FB_CARMINE --disable FB_MB862XX --disable FB_SM712 --disable SND_PCI --disable USB_PCI --disable MMC_SDHCI_PCI --disable MMC_TIFM_SD --disable MMC_CB710 --disable MMC_VIA_SDMMC --disable MMC_DW_PCI --disable MMC_TOSHIBA_PCI --module EDAC --disable EDAC_LEGACY_SYSFS --disable EDAC_DEBUG --disable EDAC_THUNDERX --disable EDAC_XGENE --disable EDAC_DMC520 --disable HISI_DMA --disable PLX_DMA --disable DW_DMAC_PCI --disable DW_EDMA --disable DW_EDMA_PCIE --disable RTL8192U --disable RTS5208 --disable VT6655 --disable FB_SM750 --disable VIDEO_ZORAN --disable STAGING_GASKET_FRAMEWORK --disable NTB --disable VME_BUS --disable USB4 --disable CRYPTO_DEV_NITROX_CNN55XX --disable CRYPTO_DEV_CAVIUM_ZIP --set-val EXTRA_FIRMWARE_DIR \\\"`pwd`/kernel/linux-firmware\\\" --set-val INPUT_MOUSEDEV_SCREEN_X 1920 --set-val INPUT_MOUSEDEV_SCREEN_Y 1080 --disable ACPI --disable SENSORS_LIS3_SPI --enable F2FS_FS --disable F2FS_STAT_FS --enable F2FS_FS_XATTR --enable F2FS_FS_POSIX_ACL --enable F2FS_FS_SECURITY --enable F2FS_CHECK_FS --disable F2FS_FAULT_INJECTION --enable F2FS_FS_COMPRESSION --enable F2FS_FS_LZO --enable F2FS_FS_LZ4 --enable F2FS_FS_ZSTD --enable F2FS_FS_LZORLE --disable EXT3_FS"
# Modularize some things upstream builds into the kernel
KERNEL_EXTRACONFIG="$KERNEL_EXTRACONFIG --module CFG80211 --module MAC80211 --module BRCMUTIL --module BRCMFMAC --module USB_NET_DRIVERS --module USB_RTL8152 --module USB_USBNET --module USB_NET_CDCETHER --module USB_NET_CDC_EEM --module USB_NET_CDC_NCM --module USB_NET_CDC_MBIM --module VIDEO_DEV --module VIDEO_V4L2 --module SND_USB_AUDIO --module SND_SOC_ROCKCHIP --module SND_SOC_RK3399_GRU_SOUND --module SND_SOC_BT_SCO --module BT --module BT_BCM --module BT_HCIUART --module BLK_DEV_NBD --module CPU_FREQ_GOV_POWERSAVE --module CPU_FREQ_GOV_USERSPACE --module CPU_FREQ_GOV_ONDEMAND --module CPU_FREQ_GOV_CONSERVATIVE --module EXT4_FS --module AUTOFS_FS --disable FAT_FS --module VFAT_FS --module EXFAT_FS --set-val EXFAT_DEFAULT_IOCHARSET \\\"utf8\\\" --module NTFS3_FS --enable NTFS3_LZX_XPRESS --enable NTFS3_POSIX_ACL --disable NTFS3_64BIT_CLUSTER --module SQUASHFS"
# RK3399 has Cortex-A72 and Cortex-A53 CPUs. Both are ARMv8.0-A, so
# ARMv8.x (x>0) features will be disabled at runtime anyway
KERNEL_EXTRACONFIG="$KERNEL_EXTRACONFIG --disable ARM64_HW_AFDBM --disable ARM64_PAN --disable ARM64_LSE_ATOMICS --disable ARM64_USE_LSE_ATOMICS --disable ARM64_VHE --disable ARM64_UAO --disable ARM64_CNP --disable ARM64_AMU_EXTN --disable ARM64_TLB_RANGE --disable ARM64_MTE"
CMDLINE="console=tty1 console=ttyS2,1500000 no_console_suspend earlycon=uart,mmio32,0x01c28000 panic=10 consoleblank=0 loglevel=1 cma=256M root=/dev/mmcblk1p2"
#NEED_INITRD=no
